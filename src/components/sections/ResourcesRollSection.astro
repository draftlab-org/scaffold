---
import Button from '@components/atoms/Button.astro';
import Heading from '@components/atoms/Heading.astro';
import ResourceItem from '@components/organisms/Resource/ResourceItem';
import { getResources, prepareResourcesCardData } from '@utils/resources';
import IconArrowRight from '~icons/heroicons/arrow-right-20-solid';

export interface Props {
  title?: string;
  description?: string;
  limit?: number;
  showViewAll?: boolean;
}

const {
  title = 'Resources',
  description,
  limit = 3,
  showViewAll = false,
} = Astro.props;

const resources = await getResources();
const limitedResources = resources.slice(0, limit);
const resourcesData = await prepareResourcesCardData(limitedResources);

// Serialize for the React component
const serializedResources = resourcesData.map(({ resource, contributorNames }) => ({
  id: resource.id,
  title: resource.data.title,
  description: resource.data.description,
  category: resource.data.category,
  year: resource.data.year,
  tags: resource.data.tags,
  externalLinks: resource.data.externalLinks,
  contributorNames,
}));
---

<div class="py-12">
  {/* Section Header */}
  <div class="mb-8">
    <Heading level={2} class="text-3xl">{title}</Heading>
    {description && <p class="mt-2 text-neutral-600">{description}</p>}
  </div>

  {/* Resources Grid */}
  {serializedResources.length === 0 ? (
    <div class="py-12 text-center">
      <p class="text-lg text-neutral-600">
        No resources available yet. Check back soon!
      </p>
    </div>
  ) : (
    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {serializedResources.map((item) => (
        <ResourceItem item={item} />
      ))}
    </div>
  )}

  {/* View All Button */}
  {showViewAll && serializedResources.length > 0 && (
    <div class="mt-8 text-center">
      <Button variant="ghost" size="sm" as="a" href="/resources">
        View All Resources
        <IconArrowRight class="ml-1 h-4 w-4" />
      </Button>
    </div>
  )}
</div>
