---
import { getCollection } from 'astro:content';
import CardSection from '@components/sections/CardSection.astro';
import HeroSection from '@components/sections/HeroSection.astro';
import PartnersSection from '@components/sections/PartnersSection.astro';
import PeopleSection from '@components/sections/PeopleSection.astro';
import RichTextSection from '@components/sections/RichTextSection.astro';
import PageLayout from '@layouts/PageLayout.astro';
import type { GetStaticPaths } from 'astro';

// Generate static paths from pages collection
export const getStaticPaths = (async () => {
  const pages = await getCollection('pages');
  return pages.map((page) => ({
    params: { path: page.id },
    props: { page },
  }));
}) satisfies GetStaticPaths;

const { page } = Astro.props;

console.log(page);
---

<PageLayout title={page.data.title} description={page.data.description}>
	<HeroSection
		title={page.data.title}
		subtitle={page.data.description}
		backgroundImage={page.data.heroImage}
		sectionLabel="hero"
	/>
	{
		page.data.sections.map((section: any) => {
			const content = (() => {
				const sectionLabel = `section > ${section.type}`;
				switch (section.type) {
					case 'hero':
						return (
							<HeroSection
								title={section.title}
								subtitle={section.subtitle}
								backgroundImage={section.backgroundImage}
								sectionLabel={sectionLabel}
							/>
						);
					case 'richText':
						return (
							<RichTextSection
								background={section.background}
								content={section.content}
							/>
						);
					case 'card':
						return (
							<CardSection
								title={section.title}
								description={section.description}
								cards={section.cards}
								buttons={section.buttons}
							/>
						);
					case 'people':
						return (
							<PeopleSection
								people={section.people}
								section={section.category}
								validateSection={false}
								customSection={true}
							/>
						);
					case 'partners':
						return (
							<PartnersSection
								title={section.title}
								partners={section.partners}
							/>
						);
					default:
						return null;
				}
			})();

			return <div class="section-container">{content}</div>;
		})
	}
</PageLayout>
